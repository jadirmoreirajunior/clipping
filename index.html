<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clipping Meio Ambiente no WhatsApp</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #e0ffe0; /* Verde claro */
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #2e8b57; /* Verde mar */
            text-align: center;
            margin-bottom: 30px;
        }
        textarea {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #a2d2a2; /* Verde suave */
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box; /* Garante que padding e border sejam inclu√≠dos na largura */
            resize: vertical;
            min-height: 200px;
        }
        button {
            background-color: #3cb371; /* Verde m√©dio */
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            display: block;
            margin: 0 auto 30px auto;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #2e8b57; /* Verde mar */
        }
        .output-label {
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
            color: #2e8b57;
        }
        .loading {
            text-align: center;
            margin-top: 20px;
            font-style: italic;
            color: #666;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåø Clipping Meio Ambiente no WhatsApp üåø</h1>

        <p>Cole o conte√∫do do seu clipping (diretamente do Notepad) na caixa abaixo:</p>
        <textarea id="inputClipping">Clipping Meio Ambiente:

CAPAS

Jornal Estado de Minas

Jornal O Tempo

Jornal Hoje Em Dia

Jornal Di√°rio do Com√©rcio

Jornal Folha de S.Paulo 

Jornal O Estado de S.Paulo

Jornal o Globo

Jornal Correio Braziliense


MAT√âRIAS QUE CITAM O SISEMA

JORNAIS


PORTAIS


YOUTUBE


OUTRAS MAT√âRIAS RELEVANTES


JORNAIS


PORTAIS

YOUTUBE

Clipping direcionado exclusivamente para servidores, sendo proibida a divulga√ß√£o para outras pessoas</textarea>

        <button onclick="formatClipping()">Formatar para WhatsApp</button>

        <div class="loading" id="loadingMessage">Encurtando links, aguarde um momento...</div>

        <span class="output-label">Conte√∫do formatado para WhatsApp (pronto para copiar):</span>
        <textarea id="outputClipping" readonly></textarea>
    </div>

    <script>
        async function shortenUrl(longUrl) {
            try {
                // Usando a API gratuita do TinyURL.
                // Recomenda-se um proxy CORS ou backend para uso em produ√ß√£o,
                // mas para um arquivo local, pode funcionar ou retornar o original em caso de erro.
                const apiUrl = `https://tinyurl.com/api-create.php?url=${encodeURIComponent(longUrl)}`;
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const shortUrl = await response.text();
                return shortUrl;
            } catch (error) {
                console.error("Erro ao encurtar URL:", error);
                return longUrl; // Retorna a URL original em caso de erro
            }
        }

        async function formatClipping() {
            const input = document.getElementById('inputClipping').value;
            const outputArea = document.getElementById('outputClipping');
            const loadingMessage = document.getElementById('loadingMessage');
            outputArea.value = ''; // Limpa a √°rea de sa√≠da
            loadingMessage.style.display = 'block'; // Mostra a mensagem de carregamento

            let lines = input.split('\n').map(line => line.trim()).filter(line => line.length > 0); // Filtra linhas vazias iniciais
            let formattedContent = [];
            let currentSection = '';
            let isInsideYouTubeSection = false; // Flag para controlar a se√ß√£o YouTube

            // Processar o cabe√ßalho e adicionar a data
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            formattedContent.push(`*Clipping Meio Ambiente: ${day}.${month}.${year}*`);
            formattedContent.push(''); // Linha em branco ap√≥s o cabe√ßalho

            // Pular o cabe√ßalho inicial que j√° est√° pr√©-preenchido
            if (lines[0] && lines[0].toLowerCase().includes('clipping meio ambiente:')) {
                lines.shift();
            }

            // Remover o rodap√© do input para adicion√°-lo no final, formatado
            const footerIndex = lines.findIndex(line => line.toLowerCase().includes('clipping direcionado exclusivamente para servidores'));
            let inputContentWithoutFooter = lines;
            if (footerIndex !== -1) {
                inputContentWithoutFooter = lines.slice(0, footerIndex);
            }
            
            for (let i = 0; i < inputContentWithoutFooter.length; i++) {
                let line = inputContentWithoutFooter[i];

                // Ignora linhas que s√£o exatamente os t√≠tulos pr√©-preenchidos
                const prefilledTitles = [
                    'Clipping Meio Ambiente:', 'CAPAS', 'MAT√âRIAS QUE CITAM O SISEMA',
                    'JORNAIS', 'PORTAIS', 'YOUTUBE', 'OUTRAS MAT√âRIAS RELEVANTES',
                    'Clipping direcionado exclusivamente para servidores, sendo proibida a divulga√ß√£o para outras pessoas'
                ];
                if (prefilledTitles.includes(line)) {
                    // Mant√©m a formata√ß√£o original desses t√≠tulos, se eles vierem do input
                    if (line.toUpperCase() === line) { // Se for um t√≠tulo de √°rea (CAPAS, MAT√âRIAS...)
                        formattedContent.push(`*${line.toUpperCase()}*`);
                        formattedContent.push(''); // Linha em branco ap√≥s o t√≠tulo da se√ß√£o
                    } else if (line.startsWith('Clipping Meio Ambiente:')) {
                         // J√° tratamos o cabe√ßalho com a data, ent√£o ignora este
                    } else if (line.startsWith('Clipping direcionado exclusivamente para servidores')) {
                        // O rodap√© ser√° adicionado no final
                    }
                    continue;
                }

                // T√≠tulos de Se√ß√£o (Mai√∫sculas, Negrito)
                const sectionTitles = ['CAPAS', 'MAT√âRIAS QUE CITAM O SISEMA', 'OUTRAS MAT√âRIAS RELEVANTES', 'JORNAIS', 'PORTAIS', 'REVISTA', 'YOUTUBE'];
                if (sectionTitles.includes(line.toUpperCase())) {
                    formattedContent.push(`\n*${line.toUpperCase()}*`); // Apenas negrito, sem it√°lico
                    formattedContent.push(''); // Linha em branco ap√≥s o t√≠tulo da se√ß√£o
                    currentSection = line.toUpperCase();
                    isInsideYouTubeSection = (currentSection === 'YOUTUBE'); // Define a flag para YouTube
                    continue;
                }

                // Nomes de Jornais/Portais/Revistas/YouTube (Negrito)
                if (line.startsWith('Jornal ') || line.startsWith('Portal ') || line.startsWith('Revista ') || (isInsideYouTubeSection && !line.match(/(https?:\/\/[^\s]+)/g))) {
                    formattedContent.push(`*${line}*`);
                    // Se estiver dentro da se√ß√£o YouTube e formatou o nome do canal,
                    // desativa a flag para que a pr√≥xima linha (t√≠tulo da mat√©ria/v√≠deo) n√£o seja negrito.
                    if (isInsideYouTubeSection) {
                        isInsideYouTubeSection = false;
                    }
                    continue;
                }

                // Links
                const urlRegex = /(https?:\/\/[^\s]+)/g;
                let match;
                let linksToShorten = [];
                while ((match = urlRegex.exec(line)) !== null) {
                    linksToShorten.push(match[0]);
                }

                if (linksToShorten.length > 0) {
                    let processedLine = line;
                    for (const link of linksToShorten) {
                        const shortLink = await shortenUrl(link);
                        processedLine = processedLine.replace(link, shortLink);
                    }
                    formattedContent.push(processedLine);
                    // Adiciona uma linha em branco ap√≥s cada link, se a pr√≥xima linha n√£o for outro link imediatamente.
                    if (i + 1 < inputContentWithoutFooter.length && !urlRegex.test(inputContentWithoutFooter[i+1])) {
                        formattedContent.push('');
                    }
                    continue; // Pula para a pr√≥xima linha
                }

                // T√≠tulos das mat√©rias (It√°lico) - se n√£o for um link, um nome de jornal/portal/YouTube ou t√≠tulo de se√ß√£o
                if (line.length > 0) { // Garante que n√£o adicione it√°lico em linhas vazias que n√£o sejam de espa√ßamento intencional
                    formattedContent.push(`_${line}_`);
                }
            }

            // Rodap√© (garantir que seja apenas uma vez e formatado corretamente)
            formattedContent.push(''); // Linha em branco antes do rodap√©
            formattedContent.push('*_Clipping direcionado exclusivamente para servidores, sendo proibida a divulga√ß√£o para outras pessoas._*');

            outputArea.value = formattedContent.join('\n');
            loadingMessage.style.display = 'none'; // Esconde a mensagem de carregamento
        }
    </script>
</body>
</html>
